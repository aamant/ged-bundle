(function(b){function a(c,d){this.container=c;this.dropzone=null;this.options=b.extend({dropzone:{paramName:"form[file]",maxFilesize:6,acceptedFiles:"image/jpeg, image/png, image/gif, application/pdf, application/x-pdf, text/plain, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, application/vnd.openxmlformats-officedocument.wordprocessingml.template, application/vnd.ms-excel, application/vnd.ms-excel, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.openxmlformats-officedocument.spreadsheetml.template, application/vnd.ms-powerpoint, application/vnd.openxmlformats-officedocument.presentationml.presentation, application/vnd.openxmlformats-officedocument.presentationml.template, application/vnd.openxmlformats-officedocument.presentationml.slideshow, application/octet-stream"}},d);this.init()}a.prototype={init:function(){Dropzone.options.dropzone=false;this.attachEvents();this.createDropzone()},createDropzone:function(){this.dropzone=new Dropzone("#dropzone",this.options.dropzone);this.dropzone.on("queuecomplete",this.reload.bind(this))},update:function(c){b(this.container).find(".card-ged").replaceWith(b(c).find(".card-ged"));this.createDropzone()},navigate:function(c){c.stopPropagation();c.preventDefault();b.ajax({url:c.target.href,success:this.update.bind(this)})},remove:function(c){c.stopPropagation();c.preventDefault();b.ajax({url:c.currentTarget.href,method:"get",success:this.update.bind(this)})},add:function(c){c.stopPropagation();c.preventDefault();b.ajax({url:c.currentTarget.action,type:"post",data:b(c.currentTarget).serialize(),success:this.update.bind(this)})},reload:function(){b.ajax({url:b(this.container).find(".card-ged").data("uri"),success:this.update.bind(this)})},attachEvents:function(){b(this.container).on("click",'[data-type="link"]',this.navigate.bind(this));b(this.container).on("click",'[data-type="remove-dir"]',this.remove.bind(this));b(this.container).on("click",'[data-type="remove-doc"]',this.remove.bind(this));b(this.container).on("submit",'[data-type="ged-add"]',this.add.bind(this))}};b.fn.ged=function(c){return this.each(function(){new a(this,c)})};b(document).ready(function(c){c('[data-model="ged"]').ged()})})(jQuery);